---
title: "Visualización de datos con R"
author: "Jorge Huanca, Jackeline García y Elías Aburto"
institute: "Avances en Medición Psicológica"
date: "13/12/2021"
output: 
  xaringan::moon_reader:
    css: [xaringan-themer.css, custom.css]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 16:11
encoding: "UTF-8"
---

class: inverse, center, middle
# .font150[Cómo construir gráficos con ggplot2]


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

```{r xaringan-themer, warning=FALSE, include=FALSE}
library(xaringanthemer)
style_mono_accent(
  base_color       = "#43418A",
  padding          = "16px 50px 12px 50px",
  code_font_google = google_font("Fira Mono")
)
```

```{r xaringanExtra, echo=FALSE}
#devtools::install_github("gadenbuie/xaringanExtra")
library(xaringanExtra)
xaringanExtra::use_xaringan_extra(c("tile_view", "tachyons", "panelset"))
xaringanExtra::use_editable(expires = 1)
xaringanExtra::use_logo(
  image_url = "img/logo.png",
  link_url = "https://www.linktr.ee/innov_lab",
  width = 100,
  height = 100
)

xaringanExtra::use_clipboard(
  button_text = "Copiar",
  success_text = "Copiado",
  error_text = "Presiona Ctrl+C para copiar"
)

xaringanExtra::use_fit_screen()

xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,          #<<
  mute_unhighlighted_code = FALSE  #<<
)
```

```{r, include=FALSE}
data <- readxl::read_excel("data3_clean.xlsx")
```
```{r, include=FALSE}
variables <- readxl::read_excel("variables.xlsx")
```

---
class: inverse

background-image:url(https://pbs.twimg.com/media/DsdIzJ3VsAAbjMW?format=jpg&name=small)
background-size: cover     



---
# Cargar paquetes 

.font105[.line-space1-5[
`Tidyverse` es un ecosistema de paquetes, entre los cuales se encuentra `ggplot2`
]]

--

```{r}
library(tidyverse)                
```


---
class: inverse, center, middle
# .font100[PRESENTACIÓN DE LA BASE DE DATOS]

---
# .font100[Características de la base de datos]

.font105[.line-space1-5[
La base de datos (data) fue extraida de una investigación que tenía por objetivo correlacionar las variables `Autoeficacia Académica (AA)` y el `Burnout (B)` en estudiantes de enfermería ]]

```{r, out.width = "100%", echo = FALSE}

DT::datatable(variables, options = list(pageLength = 5))

```

---

class: inverse, center, middle
# .font100[GRÁFICO DE BARRAS]

---
# .font100[Definicion]


.pull-left[
Los gráficos de barras permiten resumir un conjunto de datos según una **categoría** por ejemplo según fechas, sexo, países, regiones, entre otros. 

La figura muestra las proporciones medias de `variantes de COVID-19` en los distintos países entre enero de 2020 y abril de 2021. 

La imagen puede apreciarse de forma más detallada en el siguiente link (https://ars.els-cdn.com/content/image/1-s2.0-S0033350621003073-gr1.jpg)
]


.pull-right[
```{r, out.width = "100%", echo = FALSE}
knitr::include_graphics("imagenes/articulo_barras.jpg", dpi = 500)
```
]

.pull-right[
El gráfico fue extraido de la investigación **The real life impact of vaccination on COVID-19 mortality in Europe and Israel** (https://doi.org/10.1016/j.puhe.2021.07.037). 
]

---

# .font100[Diferencias entre geom_bar y geom_col]

.pull-left[
**geom_bar()** hace que la altura de la barra sea proporcional al número de casos en cada grupo (o si se suministra la estética del peso, la suma de los pesos). Utiliza stat_count() por defecto, cuenta el número de casos en cada posición x.
]

.pull-right[
**geom_col** hace que la altura de la barra represente el valor de los datos. Así mismo utiliza stat_identity() por lo que deja los datos como están.
]

.pull-right[A pesar de que se pueden usar diferentes funciones, las gráficas no varían en su diseño
]


---

# Paso 1. Conteo de la variable
.font105[.line-space1-5[
Una forma de hacer los gráficos consiste en realizar el conteo de una variable que luego será graficada. Para ello se utilizaran las funciones `count()`, `mutate()` y `factor()`. 
]]

.pull-left[
```{r, eval = FALSE}
data %>%                             
  count(ase_cat) %>%             #<<
  mutate(                        #<<
    ase_cat = factor(ase_cat),   #<<
          n = factor(n)          #<<
  )                              #<<
```
]

--

.pull-right[
```{r echo = FALSE}
data %>% 
  count(ase_cat) %>% 
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  )
```
]


---

# Paso 2. Coordenadas 
.font105[.line-space1-5[
En el segundo argumento que se refiere a las coordenadas, con `aes`, señalaremos el contenido del eje horizontal (x) y vertical (y)
]]


.pull-left[
```{r, eval = FALSE}
data %>% 
  count(ase_cat) %>% 
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n,           #<<
             x = ase_cat))    #<<

```
]

--

.pull-right[
```{r echo = FALSE, fig.retina = 3}
data %>% 
  count(ase_cat) %>% 
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n,                 
             x = ase_cat))    

```
]


---

# Paso 3. Geometrías
.font105[.line-space1-5[
El tercer argumento refiere a las geometrías, para ello agregamos una capa **(con el símbolo +) ** y colocamos `geom`
]]
.pull-left[
```{r, eval = FALSE}
data %>% 
  count(ase_cat) %>% 
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n,            
             x = ase_cat)) +   
  geom_col()                   #<<       

```
]

--

.pull-right[
```{r echo = FALSE, fig.retina = 3}
data %>% 
  count(ase_cat) %>% 
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n,            
             x = ase_cat)) +   
  geom_col()
```
]

---

# Paso 4. Color (Parte de Estéticas)
.font105[.line-space1-5[
Con `aes`, además de las coordenadas, se puede colorear el gráfico. Para ello agregaremos el argumento `fill` y en este caso, coloreamos según **ase_cat**
]]
.pull-left[
```{r, eval = FALSE}
data %>% 
  count(ase_cat) %>% 
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n,               
             x = ase_cat,         
          fill = ase_cat)) +      #<<
  geom_col()
```
]

--

.pull-right[
```{r echo = FALSE, fig.retina = 3}
data %>% 
  count(ase_cat) %>% 
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n,             
             x = ase_cat,       
          fill = ase_cat)) +    
  geom_col()
```
]

---


# Paso 5. Temas
.font105[.line-space1-5[
El cuarto argumento refiere a los temas o formatos de la gráfica, para ello agregamos una capa  y colocamos `theme`
]]
.pull-left[
```{r, eval = FALSE}
data %>% 
  count(ase_cat) %>% 
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n,            
             x = ase_cat,      
          fill = ase_cat)) +   
  geom_col() +
  theme_bw()                   #<< 
```
]

--

.pull-right[
```{r echo = FALSE}
data %>% 
  count(ase_cat) %>% 
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n, x = ase_cat,
             fill = ase_cat)) +
  geom_col() + 
  theme_bw()
```
]

---

# Paso 6. Etiquetar los gáficos
.font105[.line-space1-5[
Este argumento es para personalizar el gráfico y será útil para denotar la altura de la barra, para ello agregamos una capa y colocamos `geom_label()`. En ella podemos específicar el título, subtítulo, leyenda, y otros.
]]
.pull-left[
```{r, eval = FALSE}

data %>% 
  count(ase_cat) %>%                         
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n, 
             x = ase_cat,
          fill = ase_cat)) +
  geom_col() + 
  theme_bw() +
  geom_label(aes(label = n),                 #<<
  position = position_stack(vjust = 0.5))     #<<

```
]

--

.pull-right[
```{r echo = FALSE}
data %>% 
  count(ase_cat) %>%                         
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n, 
             x = ase_cat,
          fill = ase_cat)) +
  geom_col() + 
  theme_bw() +
  geom_label(aes(label = n),                         
  position = position_stack(vjust = 0.5))                                   
```
]


---


# Paso 7. Etiquetas
.font105[.line-space1-5[
El quinto argumento refiere a las etiquetas, para ello agregamos una capa y colocamos `labs`. En ella podemos específicar el título, subtítulo, leyenda, y otros.
]]
.pull-left[
```{r, eval = FALSE}

data %>% 
  count(ase_cat) %>% 
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n, 
             x = ase_cat,
          fill = ase_cat)) +
  geom_col() + 
  theme_bw() +
  geom_label(aes(label = n),                         
             position = position_stack(vjust = 0.5)) +
  labs(                                           #<<
  title = "Nivel de ansiedad",                    #<<
  subtitle = "Gráfica propia",                    #<<
  caption = "Avances en Medición Psicológica")    #<<

```
]

--

.pull-right[
```{r echo = FALSE}
data %>% 
  count(ase_cat) %>% 
  mutate(
    ase_cat = factor(ase_cat),
          n = factor(n)
  ) %>% 
  ggplot(aes(y = n, x = ase_cat,
             fill = ase_cat)) +
  geom_col() + 
  theme_bw() +
  labs(
    title = "Nivel de ansiedad",
    subtitle = "Gráfica propia",
    caption = "Avances en Medición Psicológica")                                      
```
]


---


# Grafico de barras con dos variables
# Paso 1
.font105[.line-space1-5[
Para este segundo gráfico utilizaremos las variables **ase_cat** y **sexo**. 
]]

.pull-left[
```{r, eval = FALSE}
data %>%                             
  count(ase_cat, sexo) %>%       #<<
  mutate(                        #<<
    ase_cat = factor(ase_cat),   #<<
          n = factor(sexo)       #<<
  )                              
```
]

--

.pull-right[
```{r echo = FALSE}
data %>%                             
  count(ase_cat, sexo) %>%       
  mutate(                        
    ase_cat = factor(ase_cat),   
          n = factor(sexo)       
  )    
```
]


---

# Paso 2. Coordenadas y relleno
.font105[.line-space1-5[
En el segundo argumento que se refiere a las coordenadas, con `aes`, señalaremos el contenido del eje horizontal (x) y vertical (y)
]]


.pull-left[
```{r, eval = FALSE}
data %>% 
  count(ase_cat, sexo) %>% 
  mutate(
    ase_cat = factor(ase_cat),  #<<
          sexo = factor(sexo)   #<<
  ) %>% 
  ggplot(aes(y = n,             #<<
             x = ase_cat,       #<<
             fill = sexo))      #<<

```
]

--

.pull-right[
```{r echo = FALSE, fig.retina = 3}
data %>% 
  count(ase_cat, sexo) %>% 
  mutate(
    ase_cat = factor(ase_cat),  
          sexo = factor(sexo)   
  ) %>% 
  ggplot(aes(y = n,             
             x = ase_cat,       
             fill = sexo))      

```
]


---
# Paso 3. Geometrías
.font105[.line-space1-5[
El tercer argumento refiere a las geometrías, para ello agregamos una capa **(con el símbolo +) ** y colocamos `geom`
]]
.pull-left[
```{r, eval = FALSE}
data %>% 
  count(ase_cat, sexo) %>% 
  mutate(
    ase_cat = factor(ase_cat),  
          sexo = factor(sexo)   
  ) %>% 
  ggplot(aes(y = n,             
             x = ase_cat,       
             fill = sexo)) +
  geom_col() +                                          #<<
  theme_bw() +                                          #<<
  geom_label(aes(label = n),                         
             position = position_stack(vjust = 0.5)) +  #<<
  labs(                                                 #<<
  title = "Nivel de ansiedad",                          #<<
  subtitle = "Gráfica propia",                          #<<
  caption = "Avances en Medición Psicológica")          #<<       

```
]

--

.pull-right[
```{r echo = FALSE, fig.retina = 3}
data %>% 
  count(ase_cat, sexo) %>% 
  mutate(
    ase_cat = factor(ase_cat),  
          sexo = factor(sexo)   
  ) %>% 
  ggplot(aes(y = n,             
             x = ase_cat,       
             fill = sexo))  +
  geom_col() +                                          
  theme_bw() +                                          
  geom_label(aes(label = n),                         
             position = position_stack(vjust = 0.5)) +  
  labs(                                                 
  title = "Nivel de ansiedad",                          
  subtitle = "Gráfica propia",                          
  caption = "Avances en Medición Psicológica")                

```
]

---
class: inverse, center, middle
# .font100[PRÁCTICA]

---

# Instrucciones
.pull-left[
1. Realice un gráfico de barras teniendo en cuenta las variables **bur_total** y **sexo**. 
2. Realice un gráfico con las variables **convive** y **bur_total**. 
]]

.pull-right[
```{r, out.width = "100%", echo = FALSE}
knitr::include_graphics("imagenes/perrito.jpg", dpi = 500)
```
]


---





# Cuerpo: Ejemplo de diferentes secciones dentro de una diapositiva
.font105[Prueba de integración del lenguaje **javascript**]

.panelset[
.panel[.panel-name[Sección 1]

#### 1. Título 1

```
<img src="https://rubenfcasal.github.io/bookdown_intro/images/rmarkdown.png" width="300px"/>
```

]

.panel[.panel-name[Sección 1]

#### 2. Título 2

```{r, echo=FALSE, comment=""}
cat(c("```{r, echo=FALSE, , out.width = '30%'}",
      "knitr::include_graphics('https://rubenfcasal.github.io/bookdown_intro/images/rmarkdown.png', 
      dpi = 600) ",
      "```"), 
    sep='\n')
```

#### HOLA MUNDO

]
]

---

class: middle

<br>
<center>
<h1>
<span style="color:black">¡Gracias por su atención!</span>
<h1>
</center>
<br>

.line-space1-5[
Estas diapositivas fueron creadas mediante el paquete [xaringan](https://github.com/yihui/xaringan) y [xaringanthemer](https://github.com/gadenbuie/xaringanthemer/). Adicionalmente, la presentación de [Brian Peña](https://github.com/brianmsm), sobre [Rmarkdown Nivel Básico](https://github.com/brianmsm/rmakdown-basico), fue tomada como guía-base para esta elaboración.
]
